# SAKTA ‚Äî –ü–æ–ª–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–¥–∏–∑–∞–π–Ω–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

## –í–µ—Ä—Å–∏—è: 2.0 (Hackathon MVP)
**–î–∞—Ç–∞:** 2025-12-13
**–ê–≤—Ç–æ—Ä:** Senior Android Engineer / Mobile Product Architect

---

## –†–ê–ó–î–ï–õ 1: –ü–ï–†–ï–ò–°–ü–û–õ–¨–ó–£–ï–ú–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´

### ‚úÖ –°–û–•–†–ê–ù–Ø–ï–ú –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –§–∞–π–ª | –ü—Ä–∏—á–∏–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è |
|-----------|------|-------------------|
| **RiskEngine** | `map/RiskEngine.kt` | –û—Ç–ª–∏—á–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞—Å—á—ë—Ç–∞ —Ä–∏—Å–∫–∞ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º –∑–∞—Ç—É—Ö–∞–Ω–∏–µ–º |
| **–¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞** | `values/colors.xml` | –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ç—ë–º–Ω–∞—è —Ç–µ–º–∞ iOS-style |
| **–°—Ç–∏–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤** | `values/styles.xml` | Material 3, –≥–æ—Ç–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –∫–Ω–æ–ø–æ–∫/–∫–∞—Ä—Ç–æ—á–µ–∫ |
| **–¢–µ–º–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** | `values/themes.xml` | –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ–º |
| **–°—Ç—Ä–æ–∫–∏ (RU)** | `values/strings.xml` | 240+ –ø–µ—Ä–µ–≤–µ–¥—ë–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫ |
| **DataManager** | `data/DataManager.kt` | –ó–∞–≥—Ä—É–∑–∫–∞ JSON –∏–∑ assets |
| **HistoryManager** | `history/HistoryManager.kt` | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤ |
| **AuthManager** | `auth/AuthManager.kt` | –ë–∞–∑–æ–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–Ω—É–∂–Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫–∞) |

### ‚úÖ –°–û–•–†–ê–ù–Ø–ï–ú –° –î–û–†–ê–ë–û–¢–ö–û–ô

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –§–∞–π–ª | –ß—Ç–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å |
|-----------|------|----------------|
| **MainActivity** | `MainActivity.kt` | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ |
| **SafeRoutingEngine** | `map/SafeRoutingEngine.kt` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π OSRM |
| **SafeRouteActivity** | `saferoute/SafeRouteActivity.kt` | –£–±—Ä–∞—Ç—å —Ö–∞—Ä–¥–∫–æ–¥, –ø–æ–¥–∫–ª—é—á–∏—Ç—å –¥–≤–∏–∂–æ–∫ |
| **HistoryActivity** | `history/HistoryActivity.kt` | –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤ |
| **SosActivity** | `sos/SosActivity.kt` | –†–µ–∞–ª—å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–∞–º |
| **ProfileActivity** | `profile/ProfileActivity.kt` | –£–∂–µ –≥–æ—Ç–æ–≤, –º–µ–ª–∫–∏–µ –ø—Ä–∞–≤–∫–∏ |

### ‚ùå –£–î–ê–õ–Ø–ï–ú / –ó–ê–ú–ï–ù–Ø–ï–ú –ü–û–õ–ù–û–°–¢–¨–Æ

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ü—Ä–∏—á–∏–Ω–∞ |
|-----------|---------|
| `family/FamilyActivity.kt` | Legacy, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
| `friends/FriendsActivity.kt` | Legacy, –∑–∞–º–µ–Ω—ë–Ω –Ω–∞ "–î–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã" |
| `route/SafeRouteActivity.kt` | –î—É–±–ª–∏–∫–∞—Ç, –µ—Å—Ç—å –≤ `/saferoute/` |
| `escort/EscortActivity.kt` | Legacy, –∑–∞–º–µ–Ω—ë–Ω –Ω–∞ EscortModeActivity |

---

## –†–ê–ó–î–ï–õ 2: –°–õ–û–ú–ê–ù–ù–´–ï –§–£–ù–ö–¶–ò–ò –ò –ó–ê–ú–ï–ù–´

### 2.1 –ú–ê–†–®–†–£–¢–ò–ó–ê–¶–ò–Ø (–ö–†–ò–¢–ò–ß–ù–û)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ú–∞—Ä—à—Ä—É—Ç—ã —Å—Ç—Ä–æ—è—Ç—Å—è, –Ω–æ –≤ SafeRouteActivity –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –•–ê–†–î–ö–û–î –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
- –ù–µ—Ç —Å–≤—è–∑–∏ –º–µ–∂–¥—É SafeRoutingEngine –∏ UI
- –ú–∞—Ä—à—Ä—É—Ç –Ω–µ —Å–ª–µ–¥—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–º —É–ª–∏—Ü–∞–º –≤ –¥–µ–º–æ

**–†–µ—à–µ–Ω–∏–µ MVP:**

```kotlin
// SafeRouteActivity.kt - –ó–ê–ú–ï–ù–ò–¢–¨ –¥–µ–º–æ-–º–∞—Ä—à—Ä—É—Ç—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ
class SafeRouteActivity : AppCompatActivity() {
    private lateinit var routingEngine: SafeRoutingEngine
    private lateinit var riskEngine: RiskEngine

    private fun buildRealRoutes() {
        lifecycleScope.launch(Dispatchers.IO) {
            try {
                // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã —á–µ—Ä–µ–∑ OSRM
                val routes = routingEngine.buildAlternativeRoutes(
                    startPoint,
                    endPoint,
                    3  // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤
                )

                withContext(Dispatchers.Main) {
                    displayRoutes(routes)
                }
            } catch (e: Exception) {
                showError("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç")
            }
        }
    }
}
```

**–¢—Ä–µ–±—É–µ–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å RiskEngine –∏ SafeRoutingEngine –≤ SafeRouteActivity
2. –£–±—Ä–∞—Ç—å hardcoded —Ç–æ—á–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∞
3. –î–æ–±–∞–≤–∏—Ç—å –≤—ã–±–æ—Ä —Ç–æ—á–µ–∫ –Ω–∞ –∫–∞—Ä—Ç–µ (tap to select)
4. –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é

---

### 2.2 –†–ï–ñ–ò–ú –°–û–ü–†–û–í–û–ñ–î–ï–ù–ò–Ø (ESCORT MODE)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–∏–º—É–ª—è—Ü–∏—è
- –ù–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
- –ù–µ—Ç —Å–≤—è–∑–∏ –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏

**–†–µ—à–µ–Ω–∏–µ MVP (Firebase Realtime Database):**

```
Firebase Structure:
‚îú‚îÄ‚îÄ escorts/
‚îÇ   ‚îî‚îÄ‚îÄ {escortId}/
‚îÇ       ‚îú‚îÄ‚îÄ ownerId: "user123"
‚îÇ       ‚îú‚îÄ‚îÄ status: "active" | "completed" | "sos"
‚îÇ       ‚îú‚îÄ‚îÄ location/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ lat: 42.8746
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ lon: 74.5698
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ timestamp: 1702483200000
‚îÇ       ‚îú‚îÄ‚îÄ route/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ start: {lat, lon}
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ end: {lat, lon}
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ points: [{lat, lon}, ...]
‚îÇ       ‚îú‚îÄ‚îÄ observers: ["userId1", "userId2"]
‚îÇ       ‚îî‚îÄ‚îÄ createdAt: 1702483200000
```

**–ù–æ–≤—ã–π EscortModeActivity:**
```kotlin
class EscortModeActivity : AppCompatActivity() {
    private lateinit var database: FirebaseDatabase
    private var escortRef: DatabaseReference? = null
    private var locationListener: ValueEventListener? = null

    // –ù–∞—á–∞—Ç—å —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ (—Å–æ–∑–¥–∞—Ç–µ–ª—å)
    private fun startEscort() {
        val escortId = UUID.randomUUID().toString()
        escortRef = database.getReference("escorts/$escortId")

        escortRef?.setValue(EscortSession(
            ownerId = currentUserId,
            status = "active",
            route = currentRoute,
            observers = trustedContactIds
        ))

        // –ù–∞—á–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –ª–æ–∫–∞—Ü–∏–∏
        startLocationUpdates()
    }

    // –ù–∞–±–ª—é–¥–∞—Ç—å –∑–∞ –¥—Ä—É–≥–∏–º (–Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—å)
    private fun observeEscort(escortId: String) {
        escortRef = database.getReference("escorts/$escortId")

        locationListener = escortRef?.child("location")
            ?.addValueEventListener(object : ValueEventListener {
                override fun onDataChange(snapshot: DataSnapshot) {
                    val location = snapshot.getValue(Location::class.java)
                    updateObserverMap(location)
                }
                override fun onCancelled(error: DatabaseError) {}
            })
    }
}
```

---

### 2.3 SOS –°–ò–°–¢–ï–ú–ê

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –û—Ç–ø—Ä–∞–≤–∫–∞ –ª–æ–∫–∞—Ü–∏–∏ ‚Äî —Å–∏–º—É–ª—è—Ü–∏—è
- –ù–µ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–æ–Ω—Ç–∞–∫—Ç–∞–º
- –ó–∞–ø–∏—Å—å –∞—É–¥–∏–æ ‚Äî –∑–∞–≥–ª—É—à–∫–∞

**–†–µ—à–µ–Ω–∏–µ MVP:**

```kotlin
class SosActivity : AppCompatActivity() {

    private fun activateSOS() {
        // 1. –í–∏–±—Ä–∞—Ü–∏—è (—É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
        vibrate()

        // 2. –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –ª–æ–∫–∞—Ü–∏—é
        val location = getCurrentLocation()

        // 3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å SMS –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–º –∫–æ–Ω—Ç–∞–∫—Ç–∞–º
        sendEmergencySMS(location)

        // 4. –ó–∞–ø–∏—Å–∞—Ç—å –≤ Firebase (–¥–ª—è –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª–µ–π)
        saveSosEvent(location)

        // 5. –ü–æ–∫–∞–∑–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        showPersistentNotification()
    }

    private fun sendEmergencySMS(location: Location) {
        val contacts = getTrustedContacts()
        val message = """
            üÜò –≠–ö–°–¢–†–ï–ù–ù–ê–Ø –°–ò–¢–£–ê–¶–ò–Ø!

            ${userName} –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª SOS –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ Sakta.

            –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ${location.latitude}, ${location.longitude}
            –í—Ä–µ–º—è: ${formatTime(System.currentTimeMillis())}

            –ö–∞—Ä—Ç–∞: https://maps.google.com/?q=${location.latitude},${location.longitude}
        """.trimIndent()

        contacts.forEach { contact ->
            val smsManager = SmsManager.getDefault()
            smsManager.sendTextMessage(contact.phone, null, message, null, null)
        }
    }
}
```

**–†–∞–∑—Ä–µ—à–µ–Ω–∏—è (–¥–æ–±–∞–≤–∏—Ç—å –≤ Manifest):**
```xml
<uses-permission android:name="android.permission.SEND_SMS" />
```

---

### 2.4 –ò–°–¢–û–†–ò–Ø –ú–ê–†–®–†–£–¢–û–í

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ú–∞—Ä—à—Ä—É—Ç—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ
- –¢–æ–ª—å–∫–æ –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ

**–†–µ—à–µ–Ω–∏–µ:**

```kotlin
// –í SafeRouteActivity –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –º–∞—Ä—à—Ä—É—Ç–∞:
private fun onRouteSelected(route: RouteOption) {
    val historyEntry = RouteHistory(
        id = UUID.randomUUID().toString(),
        userId = authManager.getCurrentUser()?.id.toString(),
        fromAddress = resolveAddress(route.data.points.first()),
        toAddress = resolveAddress(route.data.points.last()),
        fromLocation = route.data.points.first(),
        toLocation = route.data.points.last(),
        distance = route.data.distance,
        duration = route.data.duration,
        timestamp = System.currentTimeMillis(),
        routeType = route.type.name,
        safetyScore = route.evaluation.safetyScore
    )

    historyManager.saveRoute(historyEntry)

    // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –∫–∞—Ä—Ç—É —Å –º–∞—Ä—à—Ä—É—Ç–æ–º
    navigateToMainWithRoute(route)
}
```

---

### 2.5 –°–ò–°–¢–ï–ú–ê –£–í–ï–î–û–ú–õ–ï–ù–ò–ô

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –¢–æ–ª—å–∫–æ Toast
- –ù–µ—Ç NotificationChannel
- –£—Ä–æ–¥–ª–∏–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ:**

```kotlin
class NotificationHelper(private val context: Context) {

    companion object {
        const val CHANNEL_ESCORT = "escort_channel"
        const val CHANNEL_SOS = "sos_channel"
        const val CHANNEL_GENERAL = "general_channel"
    }

    init {
        createChannels()
    }

    private fun createChannels() {
        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {
            val sosChannel = NotificationChannel(
                CHANNEL_SOS,
                "–≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",
                NotificationManager.IMPORTANCE_HIGH
            ).apply {
                description = "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è SOS –∏ —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π"
                enableVibration(true)
                vibrationPattern = longArrayOf(0, 500, 200, 500)
            }

            val escortChannel = NotificationChannel(
                CHANNEL_ESCORT,
                "–†–µ–∂–∏–º —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏—è",
                NotificationManager.IMPORTANCE_DEFAULT
            ).apply {
                description = "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏—è"
            }

            val manager = context.getSystemService(NotificationManager::class.java)
            manager.createNotificationChannels(listOf(sosChannel, escortChannel))
        }
    }

    fun showEscortNotification(title: String, message: String) {
        val notification = NotificationCompat.Builder(context, CHANNEL_ESCORT)
            .setSmallIcon(R.drawable.ic_shield)
            .setContentTitle(title)
            .setContentText(message)
            .setPriority(NotificationCompat.PRIORITY_DEFAULT)
            .setAutoCancel(true)
            .build()

        NotificationManagerCompat.from(context).notify(1, notification)
    }

    fun showSosNotification() {
        val notification = NotificationCompat.Builder(context, CHANNEL_SOS)
            .setSmallIcon(R.drawable.ic_warning)
            .setContentTitle("üÜò SOS –ê–ö–¢–ò–í–ò–†–û–í–ê–ù")
            .setContentText("–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º")
            .setPriority(NotificationCompat.PRIORITY_MAX)
            .setCategory(NotificationCompat.CATEGORY_ALARM)
            .setOngoing(true)  // –ù–µ–ª—å–∑—è —Å–º–∞—Ö–Ω—É—Ç—å
            .build()

        NotificationManagerCompat.from(context).notify(999, notification)
    }
}
```

---

## –†–ê–ó–î–ï–õ 3: FIREBASE –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø

### 3.1 –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (build.gradle.kts)

```kotlin
// Firebase BoM
implementation(platform("com.google.firebase:firebase-bom:32.7.0"))

// Firebase services
implementation("com.google.firebase:firebase-auth-ktx")
implementation("com.google.firebase:firebase-database-ktx")
implementation("com.google.firebase:firebase-analytics-ktx")

// Optional: Cloud Messaging –¥–ª—è push
implementation("com.google.firebase:firebase-messaging-ktx")
```

### 3.2 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

```kotlin
// –í Application –∏–ª–∏ MainActivity
class SaktaApp : Application() {
    override fun onCreate() {
        super.onCreate()
        FirebaseApp.initializeApp(this)
    }
}
```

### 3.3 –ê–Ω–æ–Ω–∏–º–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (–¥–ª—è MVP)

```kotlin
class FirebaseAuthHelper {
    private val auth = Firebase.auth

    fun signInAnonymously(onComplete: (String?) -> Unit) {
        auth.signInAnonymously()
            .addOnSuccessListener { result ->
                onComplete(result.user?.uid)
            }
            .addOnFailureListener {
                onComplete(null)
            }
    }

    fun getCurrentUserId(): String? = auth.currentUser?.uid
}
```

### 3.4 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```
sakta-app/
‚îú‚îÄ‚îÄ users/
‚îÇ   ‚îî‚îÄ‚îÄ {userId}/
‚îÇ       ‚îú‚îÄ‚îÄ name: "–ê–π–Ω—É—Ä"
‚îÇ       ‚îú‚îÄ‚îÄ phone: "+996555123456"
‚îÇ       ‚îî‚îÄ‚îÄ trustedContacts: [...]
‚îÇ
‚îú‚îÄ‚îÄ escorts/
‚îÇ   ‚îî‚îÄ‚îÄ {escortId}/
‚îÇ       ‚îú‚îÄ‚îÄ ownerId: "userId"
‚îÇ       ‚îú‚îÄ‚îÄ status: "active"
‚îÇ       ‚îú‚îÄ‚îÄ location: {lat, lon, timestamp}
‚îÇ       ‚îú‚îÄ‚îÄ route: {start, end, points}
‚îÇ       ‚îî‚îÄ‚îÄ observers: ["userId1", "userId2"]
‚îÇ
‚îú‚îÄ‚îÄ sos_events/
‚îÇ   ‚îî‚îÄ‚îÄ {eventId}/
‚îÇ       ‚îú‚îÄ‚îÄ userId: "userId"
‚îÇ       ‚îú‚îÄ‚îÄ location: {lat, lon}
‚îÇ       ‚îú‚îÄ‚îÄ timestamp: 1702483200000
‚îÇ       ‚îî‚îÄ‚îÄ status: "active" | "resolved"
```

---

## –†–ê–ó–î–ï–õ 4: UI/UX –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 4.1 –ú–∞—Ä–∫–µ—Ä—ã –Ω–∞ –∫–∞—Ä—Ç–µ

**–ë—ã–ª–æ:** –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –ø–∏–Ω—ã

**–°—Ç–∞–Ω–µ—Ç:**
```kotlin
// –ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã
private fun createStartMarker(): Drawable {
    return ContextCompat.getDrawable(this, R.drawable.marker_start_glow)!!
}

private fun createEndMarker(): Drawable {
    return ContextCompat.getDrawable(this, R.drawable.marker_destination_shield)!!
}

private fun createDangerZoneOverlay(center: GeoPoint, radius: Double): Polygon {
    return Polygon(mapView).apply {
        points = Polygon.pointsAsCircle(center, radius)
        fillPaint.shader = RadialGradient(
            center.x, center.y, radius,
            Color.parseColor("#40FF3B30"),  // –¶–µ–Ω—Ç—Ä - –∫—Ä–∞—Å–Ω—ã–π
            Color.TRANSPARENT,               // –ö—Ä–∞–π - –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π
            Shader.TileMode.CLAMP
        )
        outlinePaint.color = Color.TRANSPARENT
    }
}
```

### 4.2 –õ–∏–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞

**–ë—ã–ª–æ:** –¢–æ–Ω–∫–∞—è –ª–∏–Ω–∏—è

**–°—Ç–∞–Ω–µ—Ç:**
```kotlin
private fun createRouteLine(points: List<GeoPoint>, riskLevel: RiskLevel): Polyline {
    return Polyline(mapView).apply {
        setPoints(points)
        outlinePaint.apply {
            strokeWidth = 14f
            strokeCap = Paint.Cap.ROUND
            strokeJoin = Paint.Join.ROUND
            color = when (riskLevel) {
                RiskLevel.SAFE -> Color.parseColor("#34C759")
                RiskLevel.MEDIUM -> Color.parseColor("#FF9500")
                RiskLevel.HIGH -> Color.parseColor("#FF3B30")
            }
            // –¢–µ–Ω—å –ø–æ–¥ –ª–∏–Ω–∏–µ–π
            setShadowLayer(8f, 0f, 4f, Color.parseColor("#40000000"))
        }
    }
}
```

### 4.3 –ö–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç—å —Ç–µ–∫—Å—Ç–∞

–í—Å–µ —Ç–µ–∫—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ WCAG AA:
- –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç: `#FFFFFF` –Ω–∞ `#0D0D0F` ‚Äî –∫–æ–Ω—Ç—Ä–∞—Å—Ç 21:1 ‚úÖ
- –í—Ç–æ—Ä–∏—á–Ω—ã–π —Ç–µ–∫—Å—Ç: `#A0A0A5` –Ω–∞ `#1E1E22` ‚Äî –∫–æ–Ω—Ç—Ä–∞—Å—Ç 5.2:1 ‚úÖ
- –¢—Ä–µ—Ç–∏—á–Ω—ã–π —Ç–µ–∫—Å—Ç: `#6E6E73` –Ω–∞ `#1E1E22` ‚Äî –∫–æ–Ω—Ç—Ä–∞—Å—Ç 3.1:1 ‚ö†Ô∏è (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–¥–ø–∏—Å–µ–π)

---

## –†–ê–ó–î–ï–õ 5: –ü–û–®–ê–ì–û–í–´–ô –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### –≠—Ç–∞–ø 1: Firebase Setup (30 –º–∏–Ω)
1. –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç Firebase Console
2. –î–æ–±–∞–≤–∏—Ç—å google-services.json –≤ /app
3. –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ build.gradle.kts
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Realtime Database rules

### –≠—Ç–∞–ø 2: –†–µ–∞–ª—å–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è (2 —á–∞—Å–∞)
1. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å SafeRoutingEngine –≤ SafeRouteActivity
2. –î–æ–±–∞–≤–∏—Ç—å –≤—ã–±–æ—Ä —Ç–æ—á–µ–∫ –Ω–∞ –∫–∞—Ä—Ç–µ
3. –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã
4. –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é

### –≠—Ç–∞–ø 3: Escort Mode (2-3 —á–∞—Å–∞)
1. –°–æ–∑–¥–∞—Ç—å FirebaseEscortManager
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏—è
3. –î–æ–±–∞–≤–∏—Ç—å location updates —á–µ—Ä–µ–∑ FusedLocationProvider
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ (observer mode)
5. –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –≠—Ç–∞–ø 4: SOS —Å SMS (1 —á–∞—Å)
1. –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ SEND_SMS
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å sendEmergencySMS()
3. –°–æ—Ö—Ä–∞–Ω—è—Ç—å SOS event –≤ Firebase
4. –î–æ–±–∞–≤–∏—Ç—å persistent notification

### –≠—Ç–∞–ø 5: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (1 —á–∞—Å)
1. –°–æ–∑–¥–∞—Ç—å NotificationHelper
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å NotificationChannels
3. –ó–∞–º–µ–Ω–∏—Ç—å Toast –Ω–∞ proper notifications
4. –î–æ–±–∞–≤–∏—Ç—å –∏–∫–æ–Ω–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (monochrome)

### –≠—Ç–∞–ø 6: UI Polish (1-2 —á–∞—Å–∞)
1. –ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã –∫–∞—Ä—Ç—ã
2. –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–µ –∑–æ–Ω—ã –æ–ø–∞—Å–Ω–æ—Å—Ç–∏
3. –£–ª—É—á—à–µ–Ω–Ω–∞—è –ª–∏–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç–∏

---

## –†–ê–ó–î–ï–õ 6: –ó–ê–í–ò–°–ò–ú–û–°–¢–ò –ò –ë–ò–ë–õ–ò–û–¢–ï–ö–ò

### –î–æ–±–∞–≤–∏—Ç—å –≤ build.gradle.kts (app):

```kotlin
plugins {
    id("com.android.application")
    id("org.jetbrains.kotlin.android")
    id("com.google.gms.google-services")  // –î–û–ë–ê–í–ò–¢–¨
}

dependencies {
    // –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ...

    // === FIREBASE ===
    implementation(platform("com.google.firebase:firebase-bom:32.7.0"))
    implementation("com.google.firebase:firebase-auth-ktx")
    implementation("com.google.firebase:firebase-database-ktx")
    implementation("com.google.firebase:firebase-analytics-ktx")

    // === LOCATION (—É–∂–µ –µ—Å—Ç—å, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é) ===
    implementation("com.google.android.gms:play-services-location:21.1.0")

    // === –†–ê–ë–û–¢–ê –° –†–ê–ó–†–ï–®–ï–ù–ò–Ø–ú–ò ===
    implementation("pub.devrel:easypermissions:3.0.0")
    // –∏–ª–∏
    implementation("com.guolindev.permissionx:permissionx:1.7.1")
}
```

### –î–æ–±–∞–≤–∏—Ç—å –≤ build.gradle.kts (project):

```kotlin
plugins {
    id("com.google.gms.google-services") version "4.4.0" apply false
}
```

### –î–æ–±–∞–≤–∏—Ç—å –≤ settings.gradle.kts:

```kotlin
pluginManagement {
    repositories {
        google()
        mavenCentral()
        gradlePluginPortal()
    }
}
```

---

## –†–ê–ó–î–ï–õ 7: –§–ê–ô–õ–´ –î–õ–Ø –°–û–ó–î–ê–ù–ò–Ø

### 7.1 –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------------|
| `firebase/FirebaseAuthHelper.kt` | –ê–Ω–æ–Ω–∏–º–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
| `firebase/FirebaseEscortManager.kt` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏—è |
| `firebase/FirebaseSosManager.kt` | SOS —Å–æ–±—ã—Ç–∏—è –≤ Firebase |
| `notifications/NotificationHelper.kt` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ |
| `location/LocationService.kt` | Foreground service –¥–ª—è —Ç—Ä–µ–∫–∏–Ω–≥–∞ |
| `res/drawable/marker_start_glow.xml` | –ú–∞—Ä–∫–µ—Ä –Ω–∞—á–∞–ª–∞ |
| `res/drawable/marker_destination_shield.xml` | –ú–∞—Ä–∫–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è |
| `google-services.json` | –ö–æ–Ω—Ñ–∏–≥ Firebase (—Å–∫–∞—á–∞—Ç—å –∏–∑ Console) |

### 7.2 –§–∞–π–ª—ã –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

1. **google-services.json**
   - –°–∫–∞—á–∞—Ç—å –∏–∑ Firebase Console ‚Üí Project Settings ‚Üí Android app

2. **–ò–∫–æ–Ω–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (monochrome)**
   - `res/drawable/ic_notif_shield.xml` ‚Äî –¥–ª—è escort
   - `res/drawable/ic_notif_warning.xml` ‚Äî –¥–ª—è SOS
   - `res/drawable/ic_notif_route.xml` ‚Äî –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–æ–≤

---

## –†–ê–ó–î–ï–õ 8: CHECKLIST –ü–ï–†–ï–î –î–ï–ú–û

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- [ ] –ú–∞—Ä—à—Ä—É—Ç —Å—Ç—Ä–æ–∏—Ç—Å—è –ø–æ —Ä–µ–∞–ª—å–Ω—ã–º —É–ª–∏—Ü–∞–º
- [ ] –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
- [ ] –í—ã–±—Ä–∞–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏—é
- [ ] Escort Mode —Å–æ–∑–¥–∞—ë—Ç —Å–µ—Å—Å–∏—é –≤ Firebase
- [ ] Observer –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å –ø–æ–∑–∏—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] SOS –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç SMS –∫–æ–Ω—Ç–∞–∫—Ç–∞–º
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ—è–≤–ª—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### UI/UX
- [ ] –ú–∞—Ä–∫–µ—Ä—ã –∫–∞—Å—Ç–æ–º–Ω—ã–µ (–Ω–µ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –ø–∏–Ω—ã)
- [ ] –õ–∏–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞ —Ç–æ–ª—Å—Ç–∞—è –∏ —Ü–≤–µ—Ç–Ω–∞—è
- [ ] –ó–æ–Ω—ã –æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º
- [ ] –í–µ—Å—å —Ç–µ–∫—Å—Ç —á–∏—Ç–∞–µ–º (–∫–æ–Ω—Ç—Ä–∞—Å—Ç OK)
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤—ã–≥–ª—è–¥—è—Ç –Ω–∞—Ç–∏–≤–Ω–æ

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ
- [ ] Firebase –ø–æ–¥–∫–ª—é—á–µ–Ω
- [ ] –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è
- [ ] –ù–µ—Ç –∫—Ä–∞—à–µ–π –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- [ ] Location —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ background

---

## –ò–¢–û–ì–û

**–í—Ä–µ–º—è –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é:** 8-10 —á–∞—Å–æ–≤
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –¥–µ–º–æ:** –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤ ‚Äî 100%

–≠—Ç–æ—Ç –ø–ª–∞–Ω –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ—Ç–æ—Ç–∏–ø –≤ —Ä–∞–±–æ—Ç–∞—é—â–∏–π MVP, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ö–∞–∫–∞—Ç–æ–Ω–µ —Å —Ä–µ–∞–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é.
